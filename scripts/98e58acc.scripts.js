"use strict";function normalize(a){var b=a.toLowerCase();return b=b.replace(new RegExp("\\s","g"),""),b=b.replace(new RegExp("[àáâãäå]","g"),"a"),b=b.replace(new RegExp("æ","g"),"ae"),b=b.replace(new RegExp("ç","g"),"c"),b=b.replace(new RegExp("[èéêë]","g"),"e"),b=b.replace(new RegExp("[ìíîï]","g"),"i"),b=b.replace(new RegExp("ñ","g"),"n"),b=b.replace(new RegExp("[òóôõö]","g"),"o"),b=b.replace(new RegExp("œ","g"),"oe"),b=b.replace(new RegExp("[ùúûü]","g"),"u"),b=b.replace(new RegExp("[ýÿ]","g"),"y"),b=b.replace(new RegExp("\\W","g"),"")}angular.module("newChartEditorApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngStorage","ui.bootstrap","angularFileUpload","ngTable","ngAnimate-animate.css","angularCharts","ngCsv","FBAngular","colorpicker.module"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/dataset",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/chart",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/dataset/create",{templateUrl:"views/dataset.html",controller:"DataSetEditCtrl"}).when("/dataset/edit/:datasetId",{templateUrl:"views/dataset.html",controller:"DataSetEditCtrl"}).when("/chart/create",{templateUrl:"views/chart.html",controller:"ChartCtrl"}).when("/chart/edit/:chartId",{templateUrl:"views/chart.html",controller:"ChartCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("newChartEditorApp").controller("DataSetEditCtrl",["$scope","$routeParams","$rootScope","$localStorage","$location","ngTableParams","$filter","$timeout",function(a,b,c,d,e,f,g,h){c.currentDataset=b.datasetId,a.datasetId=b.datasetId,a.$storage=d.$default({datasets:{}}),a.data=[],a.sharedData={title:"",datacsv:"",titles:""};var i=angular.isDefined(a.datasetId);a.computeData=function(){h(function(){a.sharedData.jsonDataAsText=JSON.stringify(a.data,null,"	");var b=a.data.map(function(a){return a.join("	")}),c=b.join("\n");a.sharedData.dataFromCopy=c},1e3)},a.deleteData=function(){delete d.datasets[a.datasetId],e.path("/")},a.onFileSelect=function(b,c){a.parseFile(b[0],c)},a.saveData=function(){angular.isDefined(a.datasetId)||(a.datasetId=normalize(a.sharedData.title));var b=a.data,c=a.sharedData.titles;if("json"===a.sharedData.source)try{b=JSON.parse(a.sharedData.jsonDataAsText),c=j([],b)}catch(d){return console.log("error "+d),!1}else if("csv"===a.sharedData.source){b=a.sharedData.datacsv;var f=a.sharedData.hasTitles?b.shift():[];c=j(f,b)}if(a.$storage.datasets[a.datasetId]={data:b,id:a.datasetId,title:a.sharedData.title,titles:c},a.data=b,a.sharedData.titles=c,i){if(a.data.length>0){a.computeData();var g=angular.element("#dataset_tableview").scope();angular.isDefined(g)&&g.reload()}}else e.path("/dataset/edit/"+a.datasetId)};var j=function(a,b){for(var c=[],d=0;d<b[0].length;d++){var e;e=angular.isDefined(a[d])?angular.isDefined(a[d].title)?a[d]:{field:"col"+d,index:d,title:a[d]}:{field:"col"+d,index:d,title:"col"+d},c.push(e)}return c};if(a.parseFile=function(b){if(angular.isDefined(b)){var c=new FileReader;c.onload=function(b){var c=b.target.result,d=d3.csv.parseRows(c.replace(/\s*;/g,","));a.sharedData.datacsv=d},c.readAsText(b)}else console.log("error: file not found");return!1},a.datasetId){var k=angular.copy(a.$storage.datasets[a.datasetId]);angular.isDefined(k)&&(a.data=k.data,a.sharedData.title=k.title||"",h(function(){a.sharedData.titles=k.titles},200))}}]),angular.module("newChartEditorApp").controller("NgTableCtrl",["$scope","$routeParams","$localStorage","ngTableParams","$filter","Fullscreen",function(a,b,c,d,e,f){var g=[],h=[],i=function(){return h||[]};if(a.getOrderedData=function(){return g},a.getCsvTitles=function(){return a.titles.map(function(a){return a.title})},a.isTooBig=function(){return g.length<=3e3},a.getTmpData=function(a){return angular.copy(a)},a.goFullscreen=function(a){f.isEnabled()?f.cancel():f.enable(document.getElementById(a))},a.reload=function(){var b=a.$storage.datasets[a.datasetId];angular.isDefined(b)&&(a.data=b.data,h=a.data,a.titles=b.titles,a.tableParams.reload())},a.saveData=function(b){a.$storage.datasets[a.datasetId].data=b},a.saveTitles=function(b){a.titles=b,a.$storage.datasets[a.datasetId].titles=b},a.datasetId=b.datasetId,a.$storage=c.$default({datasets:{}}),a.titles=[],a.tableParams=new d({page:1,count:10},{total:function(){return i().length},getData:function(b,c){var d=i(),f=a.search&&a.search.$.length>2?e("filter")(d,a.search):d;g=f,c.total(f.length),b.resolve(g.slice((c.page()-1)*c.count(),c.page()*c.count()))}}),a.datasetId){var j=a.$storage.datasets[a.datasetId];"undefined"!=typeof j&&(a.data=j.data,h=angular.copy(a.data),a.titles=j.titles)}a.$watch("search.$",function(){a.search&&a.tableParams.reload()})}]),angular.module("newChartEditorApp").controller("MainCtrl",function(){}),angular.module("newChartEditorApp").controller("MenuCtrl",["$scope","$rootScope","$localStorage","$location",function(a,b,c,d){a.datasets=c.datasets,a.charts=c.charts,a.navType="pills",a.isActive=function(a){var b=d.path().split("/"),c=b[b.length-1];return c===a},a.isMenuActive=function(a){return console.log(d.path().indexOf(a)>-1),d.path().indexOf(a)>-1},a.setActive=function(a){b.currentDataset=a},b.currentDataset="",a.goNext=function(a){b.currentDataset="",d.path(a)},a.deleteData=function(a){delete c.datasets[a],d.path("/")}}]),angular.module("newChartEditorApp").controller("ChartCtrl",["$scope","$routeParams","$rootScope","$localStorage","$location",function(a,b,c,d,e){if(c.currentChart=b.chartId,a.chartId=b.chartId,a.$storage=d.$default({charts:{},datasets:{}}),a.datasets=a.$storage.datasets,a.kindCharts=["bar","pie","line","area","point"],a.kindLegend=["lineEnd","traditional"],a.chartId){var f=a.$storage.charts[a.chartId];angular.isDefined(f)&&(a.sharedData=angular.copy(f.sharedData),a.config=angular.copy(f.config))}else a.sharedData={dataset:"",valueColumns:[{id:"",value:""}],titleColumn:"",chartType:"bar"},a.config={title:"New Chart",tooltips:!0,labels:!1,mouseover:function(){},mouseout:function(){},click:function(){},legend:{display:!0,position:"right"},colors:["steelBlue","rgb(255,153,0)","rgb(220,57,18)","rgb(70,132,238)","rgb(73,66,204)","rgb(0,128,0)"],innerRadius:0,lineLegend:"lineEnd"};a.data1={series:[],data:[]},a.computeData=function(){var b=[],c=[],d=[],e=a.sharedData.titleColumn,f=a.sharedData.valueColumns,g=a.datasets[a.sharedData.dataset];if(angular.isDefined(g)&&angular.isDefined(e)&&f.length>0){for(var h=g.titles,i={},j=0;j<h.length;j++)i[h[j].field]=h[j];e=i[e].index;for(var k=0;k<f.length;k++){var l=f[k],m=i[l.id];b.push(l.value),c.push(m.index)}angular.forEach(g.data,function(a){for(var b=[],d=0;d<c.length;d++){var f=parseFloat(a[c[d]]);f=isNaN(f)?0:f,b.push(f)}this.push({x:a[e]||0,y:b})},d)}a.data1={series:b,data:d}},a.saveData=function(){angular.isDefined(a.chartId)||(a.chartId=normalize(a.config.title)),a.$storage.charts[a.chartId]={id:a.chartId,config:a.config,sharedData:a.sharedData},e.path("/chart/edit/"+a.chartId)},a.deleteData=function(){delete d.charts[a.chartId],e.path("/")},a.computeData()}]);