/*! ngcsv 27-04-2014 */
!function(){angular.module("ngCsv.config",[]).value("ngCsv.config",{debug:!0}).config(["$compileProvider",function(a){angular.isDefined(a.urlSanitizationWhitelist)?a.urlSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/):a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/)}]),angular.module("ngCsv.directives",[]),angular.module("ngCsv",["ngCsv.config","ngCsv.directives","ngSanitize"]),angular.module("ngCsv.directives",[]).directive("ngCsv",["$parse","$q",function(a,b){return{restrict:"AC",replace:!0,transclude:!0,scope:{data:"&ngCsv",filename:"@filename",header:"&csvHeader",txtDelim:"@textDelimiter",fieldSep:"@fieldSeparator",lazyLoad:"@lazyLoad",ngClick:"&"},controller:["$scope","$element","$attrs","$transclude",function(a,c,d){var e=function(b){return"string"==typeof b?(b=b.replace(/"/g,'""'),a.txtDelim&&(b=a.txtDelim+b+a.txtDelim),b):"boolean"==typeof b?b?"TRUE":"FALSE":b};a.csv="",angular.isDefined(a.lazyLoad)&&"true"==a.lazyLoad||angular.isArray(a.data)&&a.$watch("data",function(){a.buildCsv(a.data(),function(){})},!0),a.buildCsv=function(c,f){var g="data:text/csv;charset=utf-8,";b.when(c).then(function(){if(angular.isDefined(d.csvHeader)){var b,f,h=a.$eval(a.header);angular.isArray(h)?b=h:(b=[],angular.forEach(h,function(a){this.push(e(a))},b)),f=b.join(a.fieldSep?a.fieldSep:","),g+=f+"\n"}var i;i=angular.isArray(c)?c:c(),angular.forEach(i,function(b,c){var d,f;angular.isArray(b)?f=b:(f=[],angular.forEach(b,function(a){this.push(e(a))},f)),d=f.join(a.fieldSep?a.fieldSep:","),g+=c<i.length?d+"\n":d}),a.csv=encodeURI(g)}).then(function(){f()})},a.getFilename=function(){return a.filename||"download.csv"}}],template:'<div class="csv-wrap"><div class="element" ng-transclude></div><a class="hidden-link" ng-hide="true" ng-href="{{ csv }}" download="{{ getFilename() }}"></a></div>',link:function(a,b){function c(){e[0].href="",e[0].click(),e[0].href=a.csv,e[0].click()}var d=angular.element(b.children()[0]),e=angular.element(b.children()[1]);d.bind("click",function(){a.buildCsv(a.data(),function(){c()}),a.ngClick&&a.ngClick()})}}}])}(window,document);